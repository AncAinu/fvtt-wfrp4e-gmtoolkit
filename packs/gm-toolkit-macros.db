{"_id":"2sefSFqqAbySw2nz","name":"Reduce Advantage","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"script","flags":{},"scope":"global","command":"/* Reduces Advantage for the selected token by 1 (to minimum 0).\r\n*/\r\n\r\nif (!token)\r\n  return ui.notifications.error(\"Please select a token first.\");\r\n\r\nif (Number(actor.data.data.status.advantage.value) > 0)\r\n    {\r\n        actor.update({\"data.status.advantage.value\" : Number(actor.data.data.status.advantage.value)-1}); \r\n\r\n        ui.notifications.notify(`Advantage reduced by 1 to ${Number(actor.data.data.status.advantage.value)-1} for ${actor.data.name}.`)\r\n    } \r\n    else \r\n    {\r\n        ui.notifications.notify(`${actor.data.name} already has ${actor.data.data.status.advantage.value} Advantage. No change made.`);\r\n    }\r\n","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/degen.svg","actorIds":[]}
{"_id":"6EKiEQZTbmQN97Vr","name":"Clear Advantage","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"script","flags":{},"scope":"global","command":"/* Resets Advantage for the selected token to 0 */\r\n\r\nif (!token)\r\n  return ui.notifications.error(\"Please select a token first.\");\r\n\r\nactor.update({\"data.status.advantage.value\" : 0})\r\nui.notifications.notify(`Advantage reset to 0 for ${actor.data.name}.`)","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/circle.svg","actorIds":[]}
{"_id":"AjUYYy7qAN55BERN","name":"Add Advantage","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"script","flags":{},"scope":"global","command":"/* Reduces Advantage for the selected token by 1 (to minimum 0).\r\n*/\r\n\r\nif (!token)\r\n  return ui.notifications.error(\"Please select a token first.\");\r\n\r\nif (Number(actor.data.data.status.advantage.value) > 0)\r\n    {\r\n        actor.update({\"data.status.advantage.value\" : Number(actor.data.data.status.advantage.value)-1}); \r\n\r\n        ui.notifications.notify(`Advantage reduced by 1 to ${Number(actor.data.data.status.advantage.value)-1} for ${actor.data.name}.`)\r\n    } \r\n    else \r\n    {\r\n        ui.notifications.notify(`${actor.data.name} already has ${actor.data.data.status.advantage.value} Advantage. No change made.`);\r\n    }\r\n","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/regen.svg","actorIds":[]}
{"_id":"KzO66MPdEQL809AP","name":"Set Token Vision and Light","permission":{"default":0,"5hVxcxv15974RTjj":3},"type":"script","flags":{},"scope":"global","command":"/* Open a dialog for quickly changing vision and lighting parameters of the selected token(s).\r\n * This macro requires the advanced macros functionality of Furnace by @KaKaRoTo#4756\r\n * https://github.com/kakaroto/fvtt-module-furnace/\r\n * This macro is adapted for WFRP4e from Token Vision Configuration by @Sky#9453\r\n * https://github.com/Sky-Captain-13/foundry/tree/master/scriptMacros\r\n */\r\n\r\nif (!token) \r\n  return ui.notifications.error(\"Please select a token first.\");\r\n\r\nlet applyChanges = false;\r\n\r\nconsole.log(\"Before Dialog: \", token.actor.name, \"Night Vision:\", token.actor.advNightVision);\r\n\r\nnew Dialog({\r\n  title: `Set Token Vision and Light`,\r\n  content: `\r\n    <form> \r\n      <div class=\"form-group\">\r\n        <label>Vision Type:</label>\r\n        <select id=\"vision-type\" name=\"vision-type\"> \r\n          <option value=\"normalVision\">Normal</option>\r\n          <option value=\"blindedVision\">Blinded (Condition)</option>\r\n          <option value=\"nightVision\">Night Vision (Talent)</option>\r\n          <option value=\"darkVision\">Dark Vision (Trait)</option>\r\n          <option value=\"noVision\">No Vision</option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Light Source:</label>\r\n        <select id=\"light-source\" name=\"light-source\">\r\n          <option value=\"none\">None</option>\r\n          <option value=\"candle\">Candle (10 yds)</option>\r\n          <option value=\"davrich-lamp\">Davrich Lamp (10 yds)</option>\r\n          <option value=\"torch\">Torch (15 yds)</option>\r\n          <option value=\"lantern\">Lantern (20 yds)</option>\r\n          <option value=\"storm-dim\">Storm Lantern (Broadbeam) (20 yds)</option>\r\n          <option value=\"storm-bright\">Storm Lantern (Narrowbeam) (30 yds)</option>\r\n          <option value=\"light\">Light (Petty Magic) (15 yds)</option>\r\n          <option value=\"witchlight\">Witchlight (Miscast) (20 yds)</option>\r\n          <option value=\"glowing-skin\">Glowing Skin (Mutation) (10 yds)</option>\r\n          <option value=\"ablaze\">Ablaze (Condition) (15 yds)</option>\r\n          <option value=\"pha\">Pha's Protection (WP Bonus yds)</option>\r\n        </select>\r\n      </div>\r\n    </form>\r\n    `,\r\n  buttons: {\r\n    yes: {\r\n      icon: \"<i class='fas fa-check'></i>\",\r\n      label: `Apply Changes`,\r\n      callback: () => applyChanges = true\r\n    },\r\n    no: {\r\n      icon: \"<i class='fas fa-times'></i>\",\r\n      label: `Cancel Changes`\r\n    },\r\n  },\r\n  default: \"yes\",\r\n  close: html => {\r\n    if (applyChanges) {\r\n      for ( let token of canvas.tokens.controlled ) {\r\n        let visionType = html.find('[name=\"vision-type\"]')[0].value || \"nochange\"; // TODO: default vision option based on condition -> trait -> talent\r\n\t\tlet lightSource = html.find('[name=\"light-source\"]')[0].value || \"nochange\";\r\n        let advNightVision = 0;\r\n        let dimSight = 0;\r\n        let brightSight = 0;\r\n        let dimLight = 0;\r\n        let brightLight = 0; // TODO: user define brightLight distance as ratio of dimLight\r\n        let lightAngle = 360;\r\n\t\tlet lightColor = \"\"; // TODO: apply colours for different light sources\r\n        let lockRotation = token.data.lockRotation;\r\n\t\t\r\n        // Get Light Source Values\r\n        switch (lightSource) {\r\n          case \"none\":\r\n            dimLight = 0;\r\n            brightLight = 0;\r\n            break;\r\n          case \"candle\":\r\n            dimLight = 10;\r\n            brightLight = 5;\r\n            break;\r\n          case \"torch\":\r\n            dimLight = 15;\r\n            brightLight = 7.5;\r\n            break;\r\n          case \"davrich-lamp\":\r\n            dimLight = 10;\r\n            brightLight = 5;\r\n            break;\r\n          case \"lantern\":\r\n            dimLight = 20;\r\n            brightLight = 10;\r\n            break;\r\n          case \"storm-dim\":\r\n            dimLight = 20;\r\n            brightLight = 10;\r\n            lockRotation = false;\r\n            lightAngle = 90;\r\n            break;\r\n          case \"storm-bright\":\r\n            dimLight = 30;\r\n            brightLight = 15;\r\n            lockRotation = false;\r\n            lightAngle = 60;\r\n            break;\r\n          case \"light\":\r\n            dimLight = 15;\r\n            brightLight = 7.5;\r\n            break;\r\n          case \"witchlight\":\r\n            dimLight = 20;\r\n            brightLight = 10;\r\n            break;\r\n          case \"glowing-skin\":\r\n            dimLight = 10;\r\n            brightLight = 5;\r\n            break;\r\n          case \"ablaze\":\r\n            dimLight = 15;\r\n            brightLight = 7.5;\r\n            break;\r\n          case \"pha\":\r\n            dimLight = token.actor.data.data.characteristics.wp.bonus;\r\n            brightLight = (dimLight / 2);\r\n            break;\r\n          case \"nochange\":\r\n          default:\r\n            dimLight = token.data.dimLight;\r\n            brightLight = token.data.brightLight;\r\n            lightAngle = token.data.lightAngle;\r\n            lockRotation = token.data.lockRotation;\r\n            lightColor = token.data.lightColor;\r\n        }\r\n\t\t\r\n\t\t\r\n        // Get Vision Type Values\r\n\t\tswitch (visionType) {\r\n          case \"noVision\":\r\n            dimSight = 0;\r\n            brightSight = 0;\r\n            break;\r\n          case \"normalVision\":\r\n            dimSight = 2; // TODO: user define normal vision\r\n            brightSight = 0;\r\n            break;\r\n          case \"blindedVision\":\r\n            dimSight = 1;\r\n            brightSight = 0; \t\t\t\r\n            break;\r\n          case \"nightVision\":\r\n\t\t\tlet item = token.actor.items.find(i => i.data.name === \"Night Vision\")\r\n\t\t\t\tif(item == undefined || item.data.data.advances.value < 1) {\r\n\t\t\t\t\tadvNightVision = 0;\r\n\t\t\t\t} else { \r\n\t\t\t\t\tfor (let item of token.actor.items)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t  if (item.type == \"talent\" && item.name == \"Night Vision\")\r\n\t\t\t\t\t\t  {\r\n\t\t\t\t\t\t\tadvNightVision += item.data.data.advances.value;\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\tdimSight = (20 * advNightVision) + dimLight; \r\n\t\t\tbrightSight = (5 * advNightVision) + brightLight;\r\n\t\t\tbreak;\r\n          case \"darkVision\":\r\n            dimSight = 60;\r\n            brightSight= 30;\r\n            break;\r\n          case \"nochange\":\r\n            default:\r\n            dimSight = token.data.dimSight;\r\n            brightSight = token.data.brightSight;\r\n        }\r\n\t\t\r\n        // Update Token\r\n        token.update({\r\n          vision: true,\r\n          visionType: visionType,\r\n          lightSource: lightSource,\r\n          dimLight: dimLight, \r\n          brightLight:  brightLight,\r\n          lightAngle: lightAngle,\r\n          lightColor: lightColor,\r\n          dimSight: dimSight,\r\n          brightSight: brightSight,\r\n          lockRotation: lockRotation,\r\n          advNightVision: advNightVision\r\n        });\r\n      }\r\n    }\r\n  }\r\n}).render(true);","author":"5hVxcxv15974RTjj","img":"icons/svg/blind.svg","actorIds":[]}
{"_id":"ihMGjHFP3SdvYH2k","name":"Simply d100","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"chat","flags":{},"scope":"global","command":"/r d100","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"pZmPtsEZHOpyJfnq","name":"Reset Fortune","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"script","flags":{},"scope":"global","command":"/* Restores Fortune the Fate level of targetted character(s).\r\n * Applies any Luck talent bonus.\r\n */\r\n\r\nif (game.user.targets.size < 1) \r\n  return ui.notifications.error(\"Please target a token first.\");\r\n  \r\ngame.user.targets.forEach(target => {\r\n\tconsole.log(target.actor.data.data.status.fortune.value);\r\n\r\n\tlet startingFortune = target.actor.data.data.status.fortune.value;\r\n\tlet advLuck = 0;\r\n\tlet item = target.actor.items.find(i => i.data.name === \"Luck\")\r\n\t\tif(item == undefined || item.data.data.advances.value < 1) {\r\n\t\t\tadvLuck = 0;\r\n\t\t} else { \r\n\t\t\tfor (let item of target.actor.items)\r\n\t\t\t\t{\r\n\t\t\t\t  if (item.type == \"talent\" && item.name == \"Luck\")\r\n\t\t\t\t  {\r\n\t\t\t\t\tadvLuck += item.data.data.advances.value;\r\n\t\t\t\t  }\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\ttarget.actor.update({\r\n\t\t\"data.status.fortune.value\": target.actor.data.data.status.fate.value + advLuck\r\n    })\r\n \r\n    let chatContent = `Resetting Fortune for ${target.data.name} from ${startingFortune} to ${target.actor.data.data.status.fate.value + advLuck}.`;\r\n\r\n\tlet chatData = {\r\n\t\tuser: game.user._id,\r\n\t\tcontent: chatContent\r\n    };\r\n\r\n    ChatMessage.create(chatData, {});  \r\n \tconsole.log(target.actor.data.data.status.fortune.value);\r\n})\r\n","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/temple.svg","actorIds":[]}
{"_id":"rzKeTLKp0bOp5SK9","name":"Add 20XP","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"script","flags":{},"scope":"global","command":"/* Adds a set amount of XP to targeted character(s).\r\n * Adds XP update confirmation to the Chat log.\r\n * This macro - Add XP - was written by DasSauerkraut#3215\r\n * https://github.com/CatoThe1stElder/WFRP-4th-Edition-FoundryVTT/wiki/Macro-Repository#add-xp\r\n */\r\n\r\n // Enter Wanted XP.\r\nlet XP = 20; // TODO: Add dialog box for XP. \r\n\r\nif (game.user.targets.size < 1) \r\n  return ui.notifications.error(\"Please target a token first.\");\r\n\r\ngame.user.targets.forEach(target => {\r\n  console.log(target.actor.data.data.details.experience.total)\r\n   target.actor.update({\r\n      \"data.details.experience.total\": target.actor.data.data.details.experience.total + XP\r\n    })\r\n \r\n    let chatContent = `Adding ${XP} XP to ${target.data.name}. <hr> Total  XP:  \r\n     ${target.actor.data.data.details.experience.total} -> ${target.actor.data.data.details.experience.total + XP} | Current XP: ${target.actor.data.data.details.experience.current} -> ${target.actor.data.data.details.experience.current + XP}`;\r\nlet chatData = {\r\n      user: game.user._id,\r\n      speaker: ChatMessage.getSpeaker(),\r\n      content: chatContent\r\n    };\r\n    ChatMessage.create(chatData, {});  \r\nconsole.log(target.actor.data.data.details.experience.total + XP)\r\n  console.log(target.actor.data.data.details.experience.total)\r\n})\r\n","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/up.svg","actorIds":[]}
{"_id":"tiKEfs1nB7zAMgYg","name":"Pull Everyone to Scene","permission":{"default":0,"k5y1jEYMBqd9uLUx":3},"type":"script","flags":{},"scope":"global","command":"/* Yanks every player into the scene that the GM is on. \r\n * Does not activate the scene. \r\n */\r\n\r\nif (!game.user.isGM) {\r\n  ui.notifications.warn(\"You don't have permission to pull players to scenes!\");\r\n}\r\nfor ( let u of game.users.players ) {\r\n  game.socket.emit(\"pullToScene\", game.scenes.viewed.id, u.id);\r\n}","author":"k5y1jEYMBqd9uLUx","img":"icons/svg/door-exit.svg","actorIds":[]}
